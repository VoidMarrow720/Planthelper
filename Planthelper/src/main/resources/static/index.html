<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Planthelper Admin</title>
  <style>
    body{font-family: Arial, sans-serif; padding:20px}
    .row{display:flex; gap:12px; margin-bottom:12px}
    button{padding:8px 12px}
    .panel{border:1px solid #ddd;padding:12px;border-radius:6px;margin-bottom:12px}
    label{display:block;margin:6px 0 3px}
    select,input{padding:6px;width:100%}
    .flex{display:flex;gap:8px}
  </style>
</head>
<body>
  <h1>Planthelper - Admin UI</h1>

  <div class="panel">
    <h3>Create reference entries</h3>
    <div class="row">
      <div>
        <button onclick="showCreate('groups')">New Group</button>
      </div>
      <div>
        <button onclick="showCreate('lites')">New Lite</button>
      </div>
      <div>
        <button onclick="showCreate('hums')">New Hum</button>
      </div>
      <div>
        <button onclick="showCreate('soils')">New Soil</button>
      </div>
      <div>
        <button onclick="showCreate('temps')">New Temp</button>
      </div>
      <div>
        <button onclick="showCreate('waters')">New Water</button>
      </div>
    </div>

    <div id="createForm" style="display:none; margin-top:12px">
      <label id="createLabel">Create</label>
      <div class="flex">
        <input id="createTipe" placeholder="tipe (szöveg)" />
        <button onclick="createRef()">Create</button>
        <button onclick="hideCreate()">Cancel</button>
      </div>
    </div>
  </div>

  <div class="panel">
    <h3>Add plant</h3>
    <label>Name</label>
    <input id="pNev" />
    <label>Latin name</label>
    <input id="pLatin" />

    <div class="row" style="margin-top:8px">
      <div style="flex:1">
        <label>Group</label>
        <select id="selGroup"></select>
      </div>
      <div style="flex:1">
        <label>Lite</label>
        <select id="selLite"></select>
      </div>
      <div style="flex:1">
        <label>Hum</label>
        <select id="selHum"></select>
      </div>
    </div>
    <div class="row" style="margin-top:8px">
      <div style="flex:1">
        <label>Soil</label>
        <select id="selSoil"></select>
      </div>
      <div style="flex:1">
        <label>Temp</label>
        <select id="selTemp"></select>
      </div>
      <div style="flex:1">
        <label>Water</label>
        <select id="selWater"></select>
      </div>
    </div>
    <div style="margin-top:12px">
      <button onclick="addPlant()">Add Plant</button>
      <button onclick="loadPlants()">Refresh Plants</button>
    </div>
  </div>

  <div class="panel">
    <h3>Plants</h3>
    <div id="plantsList">(loading...)</div>
  </div>

  <script>
    let creatingType = null;

    function showCreate(type){
      creatingType = type;
      document.getElementById('createLabel').innerText = 'Create '+type;
      document.getElementById('createForm').style.display = 'block';
      document.getElementById('createTipe').value = '';
    }
    function hideCreate(){
      creatingType = null;
      document.getElementById('createForm').style.display = 'none';
    }

    async function createRef(){
      const tipe = document.getElementById('createTipe').value.trim();
      if(!tipe) return alert('Adj meg egy tipe értéket');
      const res = await fetch('/'+creatingType, {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({tipe})
      });
      if(res.ok){
        hideCreate(); loadAllRefs();
      } else alert('Hiba létrehozáskor');
    }

    async function loadAllRefs(){
      await Promise.all([
        load('/groups', 'selGroup'),
        load('/lites', 'selLite'),
        load('/hums', 'selHum'),
        load('/soils', 'selSoil'),
        load('/temps', 'selTemp'),
        load('/waters', 'selWater')
      ]);
    }

    async function load(url, selectId){
      const res = await fetch(url);
      const arr = res.ok? await res.json() : [];
      const sel = document.getElementById(selectId);
      sel.innerHTML = '<option value="">-- none --</option>';
      arr.forEach(it=>{
        const opt = document.createElement('option');
        opt.value = it.id;
        opt.text = it.tipe || it.nev || ('#'+it.id);
        sel.appendChild(opt);
      });
    }

    async function addPlant(){
      const nev = document.getElementById('pNev').value.trim();
      const latin = document.getElementById('pLatin').value.trim();
      if(!nev) return alert('Adj meg nevet');
      const payload = { nev, latinNev: latin };
      const map = {
        selGroup:'group', selLite:'lite', selHum:'hum', selSoil:'soil', selTemp:'temp', selWater:'water'
      };
      for(const selId in map){
        const v = document.getElementById(selId).value;
        if(v) payload[map[selId]] = { id: Number(v) };
      }
      const res = await fetch('/plants', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
      if(res.ok){ alert('Plant saved'); loadPlants(); } else { alert('Hiba mentéskor'); }
    }

    async function loadPlants(){
      const res = await fetch('/plants');
      const arr = res.ok? await res.json():[];
      const cont = document.getElementById('plantsList');
      cont.innerHTML = '';
      arr.forEach(p=>{
        const div = document.createElement('div');
        div.style.borderTop='1px solid #eee'; div.style.padding='8px 0';
        const lines = [];
        lines.push('<b>'+ (p.nev||'') +'</b> ('+(p.latinNev||'')+') - id:'+p.id);
        if(p.group) lines.push('Group: '+(p.group.tipe||p.group.id));
        if(p.lite) lines.push('Lite: '+(p.lite.tipe||p.lite.id));
        if(p.hum) lines.push('Hum: '+(p.hum.tipe||p.hum.id));
        if(p.soil) lines.push('Soil: '+(p.soil.tipe||p.soil.id));
        if(p.temp) lines.push('Temp: '+(p.temp.tipe||p.temp.id));
        if(p.water) lines.push('Water: '+(p.water.tipe||p.water.id));
        div.innerHTML = lines.join(' | ');
        cont.appendChild(div);
      });
    }

    // initial load
    loadAllRefs(); loadPlants();
  </script>
</body>
</html>
